<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Widget JIRA</title>
</head>
<body style="font-family: Arial, sans-serif; margin: 20px;">
    <h1>Widget JIRA Test</h1>

    <div id="test-output" style="border: 1px solid #ddd; padding: 20px; background: #f9f9f9; margin: 20px 0;">
        <h3>Debug Output:</h3>
        <div id="debug-log"></div>
    </div>

    <script src="widget-new.js" data-project-id="doityourself.rocks"></script>

    <script>
        // Debug function
        function debugLog(message) {
            const debugDiv = document.getElementById('debug-log');
            debugDiv.innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + message + '</p>';
            console.log('DEBUG:', message);
        }

        // Wait for widget to load, then test
        setTimeout(async () => {
            debugLog('Testing widget...');

            // Check if project config loaded
            const projectConfig = window.getProjectConfig ? window.getProjectConfig() : null;
            if (projectConfig) {
                debugLog('✅ projectConfig loaded: ' + JSON.stringify(projectConfig));

                if (projectConfig.jira_server_url) {
                    debugLog('✅ JIRA configured: ' + projectConfig.jira_server_url);
                    debugLog('✅ JIRA show_checkbox: ' + projectConfig.show_jira_checkbox);
                } else {
                    debugLog('❌ JIRA not configured in project');
                }
            } else {
                debugLog('❌ projectConfig not loaded or getProjectConfig not available');
            }

            // Check feedbackWidget availability
            if (window.feedbackWidget) {
                debugLog('✅ feedbackWidget available');
                if (window.feedbackWidget.createScreenshotAndAnnotate) {
                    debugLog('✅ createScreenshotAndAnnotate function available');

                    // Check if widget button exists
                    const widgetButton = document.getElementById('feedback-widget-button');
                    if (widgetButton) {
                        debugLog('✅ Widget button exists in DOM');
                        debugLog('Triggering screenshot...');
                        try {
                            window.feedbackWidget.createScreenshotAndAnnotate();
                            debugLog('✅ Screenshot function called successfully');
                        } catch (error) {
                            debugLog('❌ Error calling screenshot function: ' + error.message);
                        }
                    } else {
                        debugLog('❌ Widget button not found in DOM');
                    }
                } else {
                    debugLog('❌ createScreenshotAndAnnotate not available');
                }
            } else {
                debugLog('❌ feedbackWidget not available');
            }

        }, 3000);

    </script>
</body>
</html>